Compspec, a compiler for XXX
=====================================================================

[User Manual](XXXX)
-------------

Issues can be reported on the following
[issue tracker](XXXX).

Operating systems
-----------------

Compspec requires a Unix-like system. Tested on : 
* ubuntu/groovy64. 


Installation via Opam
---------------------
TODO

Compilation from the sources
----------------------------

You can get the sources using `git` as follows:
```bash
git clone git@gitlab.lip6.fr:lprosperi/compiler.git
```

Dependencies are described in `compspec.opam`. For building the source
code documentation, one needs
[odoc](https://github.com/ocaml/odoc). For building the User Manual,
see `docs/README.md`.

Using Opam, a suitable OCaml environment can be setup as follows (automated script ``requirements.sh``):
```bash
opam switch 4.12.0
opam install yaml ounit2 process rresult pprint ppx_deriving menhir bos fileutils
```

To compile Compspec, just run the command `make` in the source directory.
This produces the `_build/install/default/bin/compspec` binary.
Use the `--help` option for more information. Other make targets are:

```bash
make                        # Build compspec 
#make doc                    # Build the user documentation (avalaible on readthedocs)
make odoc                   # Build the developer documentation
make install                # Install compspec 
#make vscode                 # Install vscode extension
make tests
```

**Note:** you can run `compspec` without installing it with `dune exec -- compspec`.

**Note:** the starting file of the source code html documentation is
`_build/default/_doc/_html/compspec/index.html`.

The following commands can be used to clean up the repository:
```bash
make clean     # Removes files generated by OCaml.
make distclean # Same as clean, but also removes library checking files.
```
### Running locally without installing

```bash
make run -- compile --debug --places examples/kvs/places.yml --targets examples/kvs/targets.yml --filename examples/kvs/kvs.spec
```

```
make run -- info
```


### Previous readme

# Dependencies
opam install process pprint ppx_deriving

* process - Easy process control, process makes it easy to use commands like functions.
* pprint - A pretty-printing combinator library and rendering engine, This library offers a set of combinators for building so-called documents as well as an efficient engine for converting documents to a textual, fixed-width format. The engine takes care of indentation and line breaks, while respecting the constraints imposed by the structure of the document and by the text width.
* ppx_deriving - Type-driven code generation for OCaml >=4.02.2 ppx_deriving provides common infrastructure for generating code based on type definitions, and a set of useful plugins for common tasks.


## Helpers

ocamlbuild -package compiler-libs.common -package ppxlib addone_ppx.native

### [dumpast](https://github.com/ocaml-ppx/ppx_tools)
This tool parses fragments of OCaml code (or entire source files) and dump the resulting internal Parsetree representation.

```bash
ocamlfind ppx_tools/dumpast -e "1 + 2"
```

The tool can be used to show the Parsetree representation of small fragments of syntax passed on the command line (-e for expressions, -p for patterns, -t for type expressions) or for entire .ml/mli files. The standard -pp and -ppx options are supported, but only applied on whole files. The tool has further option to control how location and attribute fields in the Parsetree should be displayed.


### Ocaml tools
* https://github.com/LexiFi/landmarks A simple profiling library
* https://github.com/LexiFi/dead_code_analyzer
* https://caml.inria.fr/pub/docs/manual-ocaml/parsing.html + https://github.com/lucasaiu/ocaml/blob/master/parsing/parsetree.mli
* You may think that .cmo is library, but it's not.

    .cmo is bytecode object file. It's like .class in Java.
    .cma is bytecode library. It's produce by archiving some .cmo into .cma
    .cmx is produced by ocamlopt (the native-code compiler). Main output files of ocamlopt is .o but ocamlopt also produce it.
* https://caml.inria.fr/pub/docs/manual-ocaml/lex.html#string-literal

* Interpreted use `utop`, `#use "topfind"`, `#require "exteranl pkg"` 

### Setup vim syntax coloring
1. Copy spec.vim to ~/.vim/syntax/spec.vim
2. Add the following configuration to .vimrc
```bash
"Some custom syntax coloring for abstraction specification
"Create a new filetype: *.spec
au BufRead,BufNewFile *.spec set filetype=spec
"An entry to read your syntax file is needed too:
au! Syntax spec source ~/.vim/spec.vim
```

## 
vagrant up
vagrant ssh
cd /vagrant
make
cat /tmp/compiler-build/main.java